# CI/CD Pipeline

## ğŸ¯ æ¦‚è¦

LangGraph Catalyst ã® CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€**å®Œå…¨ç„¡æ–™ï¼ˆOpenAI APIä½¿ç”¨æ–™ $0ï¼‰** ã§å‹•ä½œã—ã¾ã™ã€‚

## ğŸ’° ã‚³ã‚¹ãƒˆä¿è¨¼

| ãƒ†ã‚¹ãƒˆç¨®é¡ | APIå‘¼ã³å‡ºã— | æ–™é‡‘ |
|-----------|------------|------|
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ120ä»¶ï¼‰ | âŒ ãƒ¢ãƒƒã‚¯åŒ– | **$0.00** |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆ35ä»¶ï¼‰ | âŒ ãƒ¢ãƒƒã‚¯åŒ– | **$0.00** |
| E2E Smokeãƒ†ã‚¹ãƒˆï¼ˆ13ä»¶ï¼‰ | âŒ APIä¸ä½¿ç”¨ | **$0.00** |
| ãƒªãƒ³ãƒˆãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ | âŒ - | **$0.00** |
| ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ | âŒ - | **$0.00** |
| **æœˆé–“åˆè¨ˆ** | - | **$0.00** |

---

## ğŸ“ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«

### 1. `ci.yml` - ãƒ¡ã‚¤ãƒ³CIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**ãƒˆãƒªã‚¬ãƒ¼**:
- ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆæ™‚
- ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¸ã®ã‚³ãƒŸãƒƒãƒˆ
- mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥

**ã‚¸ãƒ§ãƒ–**:

#### 1ï¸âƒ£ Backend Tests (120 tests)
```yaml
runs-on: ubuntu-latest
env:
  OPENAI_API_KEY: sk-test-mock-key-no-real-api-calls
```

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆpytestï¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
- **å®Œå…¨ãƒ¢ãƒƒã‚¯åŒ–**: OpenAI API ã¯ä¸€åˆ‡å‘¼ã³å‡ºã•ã‚Œãªã„

**å®Ÿè¡Œæ™‚é–“**: ç´„2-3åˆ†

---

#### 2ï¸âƒ£ Frontend Tests (35 tests)
```yaml
runs-on: ubuntu-latest
```

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆVitestï¼‰
- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆï¼ˆReact Testing Libraryï¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
- **å®Œå…¨ãƒ¢ãƒƒã‚¯åŒ–**: APIå‘¼ã³å‡ºã—ãªã—

**å®Ÿè¡Œæ™‚é–“**: ç´„1-2åˆ†

---

#### 3ï¸âƒ£ Linting
```yaml
runs-on: ubuntu-latest
```

**ãƒã‚§ãƒƒã‚¯å†…å®¹**:
- Python: `ruff format --check` + `ruff check`
- TypeScript/React: `npm run lint`

**å®Ÿè¡Œæ™‚é–“**: ç´„30ç§’-1åˆ†

---

#### 4ï¸âƒ£ Build Test
```yaml
runs-on: ubuntu-latest
```

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- Viteãƒ“ãƒ«ãƒ‰
- ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®æ¤œè¨¼

**å®Ÿè¡Œæ™‚é–“**: ç´„2-3åˆ†

---

#### 5ï¸âƒ£ E2E Smoke Tests (13 tests)
```yaml
runs-on: ubuntu-latest
env:
  OPENAI_API_KEY: sk-mock-key-for-smoke-tests-no-real-calls
```

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- ãƒšãƒ¼ã‚¸è¡¨ç¤ºãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- èªè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ­ã‚°ã‚¤ãƒ³/ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£åŸºæœ¬ãƒã‚§ãƒƒã‚¯
- **APIä¸ä½¿ç”¨**: OpenAI API ã¯ä¸€åˆ‡å‘¼ã³å‡ºã•ã‚Œãªã„

**å®Ÿè¡Œæ™‚é–“**: ç´„3-5åˆ†

---

#### 6ï¸âƒ£ Report
```yaml
runs-on: ubuntu-latest
needs: [backend-tests, frontend-tests, linting, build-test, e2e-smoke-tests]
```

**ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹**:
- ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
- **APIä½¿ç”¨æ–™: $0.00** ã‚’æ˜ç¤º

---

### 2. `deploy.yml` - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**ãƒˆãƒªã‚¬ãƒ¼**:
- mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥
- æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ï¼ˆ`workflow_dispatch`ï¼‰

**ã‚¸ãƒ§ãƒ–**:

#### 1ï¸âƒ£ Deploy
```yaml
runs-on: ubuntu-latest
environment: production
```

**å‡¦ç†å†…å®¹**:
1. Renderè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤å¾…æ©Ÿ
2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆBackendï¼‰
3. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆFrontendï¼‰
4. Smokeãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
5. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒãƒªãƒ¼ä½œæˆ

**å®Ÿè¡Œæ™‚é–“**: ç´„5-10åˆ†ï¼ˆRenderãƒ“ãƒ«ãƒ‰æ™‚é–“å«ã‚€ï¼‰

---

#### 2ï¸âƒ£ Production Smoke Tests
```yaml
runs-on: ubuntu-latest
needs: deploy
```

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- æœ¬ç•ªç’°å¢ƒã§ã®smokeãƒ†ã‚¹ãƒˆï¼ˆ`@smoke` ã‚¿ã‚°ã®ã¿ï¼‰
- **APIä¸ä½¿ç”¨**: OpenAI API ã¯ä¸€åˆ‡å‘¼ã³å‡ºã•ã‚Œãªã„

**å®Ÿè¡Œæ™‚é–“**: ç´„3-5åˆ†

---

## ğŸš€ å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

### ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆæ™‚

```mermaid
graph TD
    A[PRä½œæˆ] --> B[ci.yml ãƒˆãƒªã‚¬ãƒ¼]
    B --> C[Backend Tests]
    B --> D[Frontend Tests]
    B --> E[Linting]
    B --> F[Build Test]

    C --> G[E2E Smoke Tests]
    D --> G
    E --> G
    F --> G

    G --> H[Report]
    H --> I{å…¨ãƒ†ã‚¹ãƒˆé€šé?}

    I -->|Yes| J[âœ… ãƒãƒ¼ã‚¸å¯èƒ½]
    I -->|No| K[âŒ ä¿®æ­£å¿…è¦]
```

### mainãƒ–ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸å¾Œ

```mermaid
graph TD
    A[mainãƒãƒ¼ã‚¸] --> B[ci.yml ãƒˆãƒªã‚¬ãƒ¼]
    B --> C[å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ]
    C --> D{ãƒ†ã‚¹ãƒˆæˆåŠŸ?}

    D -->|Yes| E[deploy.yml ãƒˆãƒªã‚¬ãƒ¼]
    D -->|No| F[âŒ ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­æ­¢]

    E --> G[Renderè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤]
    G --> H[ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯]
    H --> I[Production Smoke Tests]
    I --> J{æˆåŠŸ?}

    J -->|Yes| K[âœ… ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†]
    J -->|No| L[âš ï¸ è­¦å‘Šé€šçŸ¥]
```

---

## ğŸ“Š æˆåŠŸæŒ‡æ¨™

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: 86%+ï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: æ¸¬å®šä¸­
- **E2E**: Smokeãƒ†ã‚¹ãƒˆ13ä»¶

### å®Ÿè¡Œæ™‚é–“
- **CIå…¨ä½“**: ç´„10-15åˆ†
- **ãƒ‡ãƒ—ãƒ­ã‚¤å…¨ä½“**: ç´„15-25åˆ†

### æˆåŠŸç‡
- **ç›®æ¨™**: 95%ä»¥ä¸Š
- **ç¾çŠ¶**: æ¸¬å®šé–‹å§‹

---

## ğŸ› ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å®Ÿè¡Œ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
```bash
pytest tests/ -v
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
```bash
cd frontend
npm run test
```

### E2E Smokeãƒ†ã‚¹ãƒˆ
```bash
cd frontend
npm run test:e2e -- --grep "@smoke"
```

### ãƒªãƒ³ãƒˆ
```bash
# Python
ruff format --check .
ruff check .

# TypeScript/React
cd frontend
npm run lint
```

### ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
```bash
cd frontend
npm run build
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### CI/CDãŒå¤±æ•—ã™ã‚‹å ´åˆ

1. **ãƒ­ãƒ¼ã‚«ãƒ«ã§å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ**
   ```bash
   pytest tests/ -v
   cd frontend && npm run test
   ```

2. **ãƒªãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£**
   ```bash
   ruff format .
   ruff check . --fix
   cd frontend && npm run lint
   ```

3. **ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª**
   ```bash
   cd frontend && npm run build
   ```

### GitHub Actions ãƒ­ã‚°ã®ç¢ºèª

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã®ã€ŒActionsã€ã‚¿ãƒ–ã‚’é–‹ã
2. å¤±æ•—ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯
3. å„ã‚¸ãƒ§ãƒ–ã®ãƒ­ã‚°ã‚’ç¢ºèª
4. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿®æ­£

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [GitHub Actions å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.github.com/en/actions)
- [Playwright CI Integration](https://playwright.dev/docs/ci-intro)
- [pytest å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.pytest.org/)
- [Vitest å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vitest.dev/)

---

## ğŸ’¡ ä»Šå¾Œã®æ‹¡å¼µï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### APIä½¿ç”¨æ–™ãŒç™ºç”Ÿã™ã‚‹ãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•å®Ÿè¡Œã®ã¿ï¼‰

å°†æ¥çš„ã«ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã§ãã¾ã™ï¼ˆ**CI/CDã§ã¯å®Ÿè¡Œã—ãªã„**ï¼‰:

```yaml
# .github/workflows/manual-e2e.yml (å°†æ¥å®Ÿè£…)
name: Manual E2E Tests (API Calls)

on:
  workflow_dispatch:  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ã®ã¿

jobs:
  expensive-e2e:
    runs-on: ubuntu-latest
    steps:
      - name: Run RAG E2E tests
        run: npx playwright test e2e/rag.spec.ts
      - name: Run Architect E2E tests
        run: npx playwright test e2e/architect.spec.ts
```

**æ¨å®šæ–™é‡‘**: 1å›ã®å®Ÿè¡Œã‚ãŸã‚Š $0.30-1.00

**å®Ÿè¡Œæ–¹æ³•**:
- GitHub Actions ã®ã€ŒActionsã€ã‚¿ãƒ–
- ã€ŒManual E2E Testsã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠ
- ã€ŒRun workflowã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

---

## âœ… ã¾ã¨ã‚

- âœ… **å®Œå…¨ç„¡æ–™**: OpenAI APIä½¿ç”¨æ–™ $0.00
- âœ… **é«˜é€Ÿ**: å…¨ä½“ã§ç´„10-15åˆ†
- âœ… **ä¿¡é ¼æ€§**: 155+ ãƒ†ã‚¹ãƒˆï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆ + E2E Smokeï¼‰
- âœ… **è‡ªå‹•åŒ–**: PRä½œæˆæ™‚ã€mainãƒãƒ¼ã‚¸æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
- âœ… **æ‹¡å¼µæ€§**: å°†æ¥çš„ã«APIä½¿ç”¨ãƒ†ã‚¹ãƒˆã‚’æ‰‹å‹•å®Ÿè¡Œå¯èƒ½
