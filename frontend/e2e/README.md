# E2E Tests

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Playwright ã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ï¼ˆE2Eï¼‰ãƒ†ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ§ª å®Ÿè£…æ¸ˆã¿ãƒ†ã‚¹ãƒˆ

### âœ… Smoke Tests (`smoke.spec.ts`) - **å®Œå…¨ç„¡æ–™**

**OpenAI API ã‚’ä¸€åˆ‡ä½¿ç”¨ã—ãªã„**smokeãƒ†ã‚¹ãƒˆã®ã¿ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

| ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª | ãƒ†ã‚¹ãƒˆæ•° | APIä½¿ç”¨æ–™ |
|-------------|---------|---------|
| ãƒšãƒ¼ã‚¸è¡¨ç¤º | 3 | $0.00 |
| ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ | 2 | $0.00 |
| èªè¨¼ãƒ•ãƒ­ãƒ¼ | 5 | $0.00 |
| ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– | 1 | $0.00 |
| ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ | 2 | $0.00 |
| **åˆè¨ˆ** | **13** | **$0.00** |

### ãƒ†ã‚¹ãƒˆå¯¾è±¡

- âœ… ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®è¡¨ç¤º
- âœ… å…¨ãƒšãƒ¼ã‚¸ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå­¦ç¿’ãƒ‘ã‚¹ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€RAGã€æ§‹æˆæ¡ˆç”Ÿæˆï¼‰
- âœ… ä¿è­·ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- âœ… ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º
- âœ… ãƒ­ã‚°ã‚¤ãƒ³ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… ç„¡åŠ¹ãªèªè¨¼æƒ…å ±ã§ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- âœ… ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£åŸºæœ¬ãƒã‚§ãƒƒã‚¯

### ãƒ†ã‚¹ãƒˆ**ã—ãªã„**ã‚‚ã®ï¼ˆæ‰‹å‹•ãƒ†ã‚¹ãƒˆã§ç¢ºèªï¼‰

- âŒ RAGæ©Ÿèƒ½ï¼ˆOpenAI APIä½¿ç”¨ã®ãŸã‚ï¼‰
- âŒ æ§‹æˆæ¡ˆç”Ÿæˆæ©Ÿèƒ½ï¼ˆOpenAI APIä½¿ç”¨ã®ãŸã‚ï¼‰
- âŒ å®Ÿéš›ã®ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸãƒ•ãƒ­ãƒ¼ï¼ˆèªè¨¼APIä½¿ç”¨ã®ãŸã‚ï¼‰

---

## ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd frontend

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
npm ci

# Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰
npx playwright install

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
cd ..
uvicorn backend.main:app --reload

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
cd frontend
npm run dev

# E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:e2e

# smokeãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npx playwright test --grep "@smoke"

# UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ï¼‰
npx playwright test --ui
```

### CI/CDå®Ÿè¡Œ

CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯è‡ªå‹•çš„ã«ä»¥ä¸‹ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

```bash
npx playwright test --grep "@smoke"
```

---

## ğŸ”® å°†æ¥ã®æ‹¡å¼µæ©Ÿèƒ½ï¼ˆæ‰‹å‹•å®Ÿè¡Œã®ã¿ï¼‰

### RAGæ©Ÿèƒ½ã®E2Eãƒ†ã‚¹ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰

RAGæ©Ÿèƒ½ã®E2Eãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã§ãã¾ã™ï¼š

```typescript
// frontend/e2e/rag.spec.ts (å°†æ¥å®Ÿè£…)

test.describe('RAG Feature (MANUAL ONLY)', () => {
  test('should submit question and receive answer', async ({ page }) => {
    // âš ï¸ WARNING: OpenAI API ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€æ‰‹å‹•å®Ÿè¡Œã®ã¿
    // CI/CD ã§ã¯å®Ÿè¡Œã—ãªã„ã“ã¨
  });
});
```

**å®Ÿè¡Œæ–¹æ³•ï¼ˆæ‰‹å‹•ã®ã¿ï¼‰**:
```bash
# RAGãƒ†ã‚¹ãƒˆã‚’æ‰‹å‹•å®Ÿè¡Œï¼ˆAPIä½¿ç”¨æ–™ç™ºç”Ÿï¼‰
npx playwright test e2e/rag.spec.ts
```

**æ¨å®šæ–™é‡‘**: 1å›ã®å®Ÿè¡Œã‚ãŸã‚Š $0.05-0.15

### æ§‹æˆæ¡ˆç”Ÿæˆæ©Ÿèƒ½ã®E2Eãƒ†ã‚¹ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰

```typescript
// frontend/e2e/architect.spec.ts (å°†æ¥å®Ÿè£…)

test.describe('Architecture Generation (MANUAL ONLY)', () => {
  test('should generate architecture from business challenge', async ({ page }) => {
    // âš ï¸ WARNING: OpenAI API ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã€æ‰‹å‹•å®Ÿè¡Œã®ã¿
  });
});
```

**å®Ÿè¡Œæ–¹æ³•ï¼ˆæ‰‹å‹•ã®ã¿ï¼‰**:
```bash
# æ§‹æˆæ¡ˆç”Ÿæˆãƒ†ã‚¹ãƒˆã‚’æ‰‹å‹•å®Ÿè¡Œï¼ˆAPIä½¿ç”¨æ–™ç™ºç”Ÿï¼‰
npx playwright test e2e/architect.spec.ts
```

**æ¨å®šæ–™é‡‘**: 1å›ã®å®Ÿè¡Œã‚ãŸã‚Š $0.10-0.30

---

## ğŸ“Š ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ

ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã€ä»¥ä¸‹ã®å ´æ‰€ã«ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```
frontend/
â”œâ”€â”€ playwright-report/     # HTMLãƒ¬ãƒãƒ¼ãƒˆ
â”œâ”€â”€ test-results/          # ãƒ†ã‚¹ãƒˆçµæœã®è©³ç´°
â””â”€â”€ playwright-report/
    â””â”€â”€ index.html        # ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ç¢ºèª
```

**ãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤º**:
```bash
npx playwright show-report
```

---

## ğŸ›¡ï¸ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ã‚¿ã‚°ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆã‚’åˆ†é¡

```typescript
// @smoke ã‚¿ã‚°: APIä¸ä½¿ç”¨ã®ãƒ†ã‚¹ãƒˆï¼ˆCI/CDã§å®Ÿè¡Œï¼‰
test('should display homepage @smoke', async ({ page }) => {
  // ...
});

// @expensive ã‚¿ã‚°: APIä½¿ç”¨ã®ãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•å®Ÿè¡Œã®ã¿ï¼‰
test('should query RAG @expensive', async ({ page }) => {
  // ...
});
```

### 2. CI/CDã§ã¯smokeãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ

```bash
# CI/CD
npx playwright test --grep "@smoke"

# ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆå…¨ãƒ†ã‚¹ãƒˆï¼‰
npx playwright test
```

### 3. APIä½¿ç”¨æ–™ã®ç›£è¦–

å°†æ¥çš„ã«APIä½¿ç”¨ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

```bash
# .env ã«æœˆé–“äºˆç®—ã‚’è¨­å®š
E2E_MONTHLY_BUDGET=20  # $20/æœˆ

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ãƒã‚§ãƒƒã‚¯
if [ $(date +%d) -lt 5 ]; then
  echo "âš ï¸ Month start - Check API budget"
fi
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Playwrightãƒ–ãƒ©ã‚¦ã‚¶ãŒèµ·å‹•ã—ãªã„

```bash
# ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npx playwright install --with-deps
```

### ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹

```bash
# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·
npx playwright test --timeout=60000
```

### ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ/ãƒ“ãƒ‡ã‚ªã‚’ç¢ºèª

ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨ãƒ“ãƒ‡ã‚ªã¯ `test-results/` ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Playwright å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://playwright.dev/)
- [Playwright Best Practices](https://playwright.dev/docs/best-practices)
- [GitHub Actions ã§ã® Playwright](https://playwright.dev/docs/ci-intro)

---

## ğŸ’¡ Tips

### ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

```bash
npx playwright test --headed
```

### ç‰¹å®šã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿å®Ÿè¡Œ

```bash
npx playwright test --project=chromium
```

### ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ

```bash
npx playwright test --debug
```
